.. include:: ./substitutions.rst

Plotting - matplotlib
=====================

Wrappers
--------

These functions provide a high-level API for visualizing various objects/results (e.g., :class:`~deareis.DataSet`).
Most of them are the same functions included in pyimpspec_ with the notable exception of :func:`~deareis.mpl.plot`.

.. automodule:: deareis.mpl
   :members: plot, plot_circuit, plot_data, plot_drt, plot_fit, plot_kramers_kronig_tests



Primitives
----------

These functions are used by the wrapper functions to make a more complex figure with multiple subplots.
These are all the same as those included in pyimpspec_.

.. automodule:: deareis.mpl
   :members: plot_bht_scores, plot_bode, plot_real_imaginary, plot_gamma, plot_imaginary, plot_magnitude, plot_mu_xps, plot_nyquist, plot_phase, plot_real, plot_residuals


Examples
--------

Below are some examples of plots created using the plotting functions listed above.
The circuit and the data set are based on test circuit 1 (TC-1) from this 1995 article by `Bernard Boukamp`_.

Legends are disabled and colored axes are used instead in the figures generated by the wrapper functions (i.e., the first figure in each series).
This has been done due to the small size of the figures in this documentation.
However, the figures generated by the individual primitive functions are also included with the legends enabled and without colored axes.

The default color scheme is based on the *Vibrant qualitative* color scheme presented in `Paul Tol`_'s blog.
Colors and markers can be defined when calling any of the functions.

.. _Bernard Boukamp: https://doi.org/10.1149/1.2044210
.. _Paul Tol: https://personal.sron.nl/~pault/


plot
~~~~
:func:`~deareis.mpl.plot`

.. plot::

   from deareis import Project
   from deareis import mpl
   project = Project.from_file("../../tests/example-project-v6.json")
   for plot in project.get_plots():
     if "DRT" not in plot.get_label():
       continue
     figure, axes = mpl.plot(plot, project)
     break

.. raw:: latex

    \clearpage


plot_circuit
~~~~~~~~~~~~
:func:`~deareis.mpl.plot_circuit`

* :func:`~deareis.mpl.plot_nyquist`
* :func:`~deareis.mpl.plot_bode`

.. plot::

  from deareis import mpl
  import pyimpspec
  from numpy import logspace, log10 as log

  data = pyimpspec.generate_mock_data("CIRCUIT_1", noise=5e-2, seed=42)[0]
  circuit = pyimpspec.generate_mock_circuits("CIRCUIT_1")[0]
  f = data.get_frequencies()
  figure, axes = mpl.plot_circuit(circuit, frequencies=f, label="TC-1", title="", legend=False, colored_axes=True)
  figure.tight_layout()
  mpl.show()

  data = pyimpspec.simulate_spectrum(
    circuit,
    logspace(
      log(max(f)),
      log(min(f)),
      num=int(log(max(f)) - log(min(f))) * 100 + 1,
    ),
    label="TC-1",
  )
  figure, axes = mpl.plot_nyquist(data, line=True)
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_bode(data, line=True)
  figure.tight_layout()
  mpl.show()

.. raw:: latex

    \clearpage


plot_data
~~~~~~~~~
:func:`~deareis.mpl.plot_data`

* :func:`~deareis.mpl.plot_nyquist`
* :func:`~deareis.mpl.plot_bode`

.. plot::

  from deareis import mpl
  import pyimpspec
  import pyimpspec.plot.colors as colors

  data = pyimpspec.generate_mock_data("CIRCUIT_1", noise=5e-2, seed=42)[0]
  figure, axes = mpl.plot_data(data, legend=False, colored_axes=True)
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_nyquist(data)
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_bode(data)
  figure.tight_layout()
  mpl.show()

.. raw:: latex

    \clearpage


plot_drt
~~~~~~~~
:func:`~deareis.mpl.plot_drt`

* :func:`~deareis.mpl.plot_real_imaginary`
* :func:`~deareis.mpl.plot_gamma`
* :func:`~deareis.mpl.plot_residuals`

.. plot::

  from deareis import mpl
  import pyimpspec
  import pyimpspec.plot.colors as colors

  data = pyimpspec.generate_mock_data("CIRCUIT_1", noise=5e-2, seed=42)[0]
  drt = pyimpspec.analysis.drt.calculate_drt_tr_rbf(data)
  figure, axes = mpl.plot_drt(
    drt,
    data,
    legend=False,
    colored_axes=True,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_real_imaginary(
    data,
    colors={
      "real": colors.COLOR_BLACK,
      "imaginary": colors.COLOR_BLACK,
    },
    legend=False,
  )
  _ = mpl.plot_real_imaginary(
    drt,
    line=True,
    figure=figure,
    axes=axes,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_gamma(drt)
  figure.tight_layout()
  mpl.show()


  figure, axes = mpl.plot_residuals(drt)
  figure.tight_layout()
  mpl.show()

.. raw:: latex

    \clearpage


plot_fit
~~~~~~~~
:func:`~deareis.mpl.plot_fit`

* :func:`~deareis.mpl.plot_nyquist`
* :func:`~deareis.mpl.plot_bode`
* :func:`~deareis.mpl.plot_residuals`

.. plot::

  from deareis import mpl
  import pyimpspec
  import pyimpspec.plot.colors as colors

  data = pyimpspec.generate_mock_data("CIRCUIT_1", noise=5e-2, seed=42)[0]
  circuit = pyimpspec.parse_cdc("R(RC)(RW)")
  fit = pyimpspec.fit_circuit(circuit, data=data)

  figure, axes = mpl.plot_fit(
    fit,
    data,
    legend=False,
    colored_axes=True,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_nyquist(
    data,
    colors={"impedance": colors.COLOR_BLACK},
    legend=False,
  )
  _ = mpl.plot_nyquist(
    fit,
    line=True,
    figure=figure,
    axes=axes,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_bode(
    data,
    colors={
      "magnitude": colors.COLOR_BLACK,
      "phase": colors.COLOR_BLACK,
    },
    legend=False,
  )
  _ = mpl.plot_bode(
    fit,
    line=True,
    figure=figure,
    axes=axes,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_residuals(fit)
  figure.tight_layout()
  mpl.show()

.. raw:: latex

    \clearpage


plot_kramers_kronig_tests
~~~~~~~~~~~~~~~~~~~~~~~~~
:func:`~deareis.mpl.plot_kramers_kronig_tests`

* :func:`~deareis.mpl.plot_pseudo_chisqr`
* :func:`~deareis.mpl.plot_num_RC_suggestion`
* :func:`~deareis.mpl.plot_residuals`
* :func:`~deareis.mpl.plot_nyquist`
* :func:`~deareis.mpl.plot_bode`


.. plot::

  from deareis import mpl
  import pyimpspec
  import pyimpspec.plot.colors as colors

  data = pyimpspec.generate_mock_data("CIRCUIT_1", noise=5e-2, seed=42)[0]
  mu_criterion = 0.85
  tests, suggestion = pyimpspec.perform_exploratory_kramers_kronig_tests(
    data,
    mu_criterion=mu_criterion,
    add_capacitance=True,
  )
  test, scores, lower_limit, upper_limit = suggestion


  figure, axes = mpl.plot_kramers_kronig_tests(
    tests,
    suggestion,
    data,
    legend=False,
    colored_axes=True,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_pseudo_chisqr(
    tests,
    lower_limit=lower_limit,
    upper_limit=upper_limit,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_num_RC_suggestion(suggestion)
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_residuals(test)
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_nyquist(
    data,
    colors={"impedance": colors.COLOR_BLACK},
    legend=False,
  )
  _ = mpl.plot_nyquist(
    test,
    line=True,
    figure=figure,
    axes=axes,
  )
  figure.tight_layout()
  mpl.show()

  figure, axes = mpl.plot_bode(
    data,
    colors={
      "magnitude": colors.COLOR_BLACK,
      "phase": colors.COLOR_BLACK,
    },
    legend=False,
  )
  _ = mpl.plot_bode(
    test,
    line=True,
    figure=figure,
    axes=axes,
  )
  figure.tight_layout()
  mpl.show()

.. raw:: latex

    \clearpage
